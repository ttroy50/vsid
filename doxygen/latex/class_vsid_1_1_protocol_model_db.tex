\hypertarget{class_vsid_1_1_protocol_model_db}{\section{Vsid\-:\-:Protocol\-Model\-Db Class Reference}
\label{class_vsid_1_1_protocol_model_db}\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}}
}


{\ttfamily \#include $<$Protocol\-Model\-Db.\-h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_vsid_1_1_protocol_model_db_a5add89591932a7851cca9df71e9c2873}{Protocol\-Model\-Db} (std\-::string \hyperlink{class_vsid_1_1_protocol_model_db_ae4c2e7652218bb11f10bf0d4d0d0257d}{filename}, std\-::string backupfile)
\item 
bool \hyperlink{class_vsid_1_1_protocol_model_db_ab4cdbc95950371528dea8adbc39fccef}{read} ()
\item 
bool \hyperlink{class_vsid_1_1_protocol_model_db_a6555ccdf11081b5e255ee3b8d17a7ea8}{write} ()
\item 
std\-::shared\-\_\-ptr$<$ \hyperlink{class_vsid_1_1_protocol_model}{Protocol\-Model} $>$ \hyperlink{class_vsid_1_1_protocol_model_db_a542f3434c2a9d97ee2632200372a6a88}{find} (const std\-::string \&name)
\item 
std\-::shared\-\_\-ptr$<$ \hyperlink{class_vsid_1_1_protocol_model}{Protocol\-Model} $>$ \hyperlink{class_vsid_1_1_protocol_model_db_a4209a57665d19cc6abf920a5cfb0500c}{front} (uint16\-\_\-t port=0)
\item 
std\-::shared\-\_\-ptr$<$ \hyperlink{class_vsid_1_1_protocol_model}{Protocol\-Model} $>$ \hyperlink{class_vsid_1_1_protocol_model_db_a5bc72492cdde09f1bf753e0ebee26e9e}{at} (size\-\_\-t pos, uint16\-\_\-t port=0)
\item 
size\-\_\-t \hyperlink{class_vsid_1_1_protocol_model_db_a83473d93ae3503810ce0b2ed3de19836}{size} () const 
\item 
uint32\-\_\-t \hyperlink{class_vsid_1_1_protocol_model_db_a511e5fdf67995099e81175a6d34d1aac}{defining\-Limit} () const 
\item 
uint32\-\_\-t \hyperlink{class_vsid_1_1_protocol_model_db_a2df8e380ce56c8509007df98fce27d09}{cutoff\-Limit} () const 
\item 
std\-::string \hyperlink{class_vsid_1_1_protocol_model_db_ae4c2e7652218bb11f10bf0d4d0d0257d}{filename} () const 
\item 
boost\-::posix\-\_\-time\-::ptime \hyperlink{class_vsid_1_1_protocol_model_db_ab7111a24bbb1c4eb6fb1a2ea61dbcaa6}{last\-Modified\-Time} () const 
\item 
std\-::string \hyperlink{class_vsid_1_1_protocol_model_db_a277630c01a8dc5a95ec5ded8e1e68197}{last\-Modified\-Time\-As\-String} () const 
\item 
std\-::string \hyperlink{class_vsid_1_1_protocol_model_db_a9c185b6df9f6f41baa1500251c7b723b}{database\-Version} () const 
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The Protocol Model Database.

The class holds the models and fingerprints for all supported protocols, which are read in from a Y\-A\-M\-L formatted file 

Definition at line 34 of file Protocol\-Model\-Db.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{class_vsid_1_1_protocol_model_db_a5add89591932a7851cca9df71e9c2873}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!Protocol\-Model\-Db@{Protocol\-Model\-Db}}
\index{Protocol\-Model\-Db@{Protocol\-Model\-Db}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{Protocol\-Model\-Db}]{\setlength{\rightskip}{0pt plus 5cm}Protocol\-Model\-Db\-::\-Protocol\-Model\-Db (
\begin{DoxyParamCaption}
\item[{std\-::string}]{filename, }
\item[{std\-::string}]{backupfile}
\end{DoxyParamCaption}
)}}\label{class_vsid_1_1_protocol_model_db_a5add89591932a7851cca9df71e9c2873}
Constructor.


\begin{DoxyParams}{Parameters}
{\em filename} & The filename to read the db from and write the new one to \\
\hline
{\em backupfile} & The filename to backup the old D\-B to on write \\
\hline
\end{DoxyParams}


Definition at line 14 of file Protocol\-Model\-Db.\-cpp.


\begin{DoxyCode}
14                                                                    :
15     \_filename(\hyperlink{class_vsid_1_1_protocol_model_db_ae4c2e7652218bb11f10bf0d4d0d0257d}{filename}),
16     \_initialised(\textcolor{keyword}{false}),
17     \_cutoffLimit(100),
18     \_definingLimit(10)
19 \{
20     \textcolor{keywordflow}{if}(backupfile.empty())
21     \{
22         \_backupfile = \_filename + \textcolor{stringliteral}{".prev"};
23     \}
24     \textcolor{keywordflow}{else}
25     \{
26         \_backupfile = backupfile;
27     \}
28 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{class_vsid_1_1_protocol_model_db_a5bc72492cdde09f1bf753e0ebee26e9e}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!at@{at}}
\index{at@{at}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{at}]{\setlength{\rightskip}{0pt plus 5cm}std\-::shared\-\_\-ptr$<$ {\bf Protocol\-Model} $>$ Protocol\-Model\-Db\-::at (
\begin{DoxyParamCaption}
\item[{size\-\_\-t}]{pos, }
\item[{uint16\-\_\-t}]{port = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}\label{class_vsid_1_1_protocol_model_db_a5bc72492cdde09f1bf753e0ebee26e9e}
Get the protocol model at a certain position


\begin{DoxyParams}{Parameters}
{\em pos} & The position in the list you get \\
\hline
{\em port} & The port that you are looking for. 0 means default list\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 524 of file Protocol\-Model\-Db.\-cpp.


\begin{DoxyCode}
525 \{
526     \textcolor{keywordflow}{if}(port == 0)
527     \{
528         \textcolor{keywordflow}{if}(pos < \_protocolModelOrder.size() )
529         \{
530             \textcolor{keywordflow}{return} \_protocolModelOrder[pos];
531         \}
532         \textcolor{keywordflow}{else}
533         \{
534             \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
535         \}
536     \}
537     \textcolor{keywordflow}{else}
538     \{
539         \textcolor{keyword}{auto} it = \_portHintOrder.find(port);
540         \textcolor{keywordflow}{if}(it != \_portHintOrder.end())
541         \{
542             \textcolor{keywordflow}{if}( pos < it->second.size() )
543             \{
544                 \textcolor{keywordflow}{return} it->second[pos];
545             \}
546             \textcolor{keywordflow}{else}
547             \{
548                 \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
549             \}
550         \}
551         \textcolor{keywordflow}{else}
552         \{
553             \textcolor{keywordflow}{if}( pos < \_protocolModelOrder.size() )
554             \{
555                 \textcolor{keywordflow}{return} \_protocolModelOrder[pos];
556             \}
557             \textcolor{keywordflow}{else}
558             \{
559                 \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
560             \}
561         \}
562     \}
563 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a5bc72492cdde09f1bf753e0ebee26e9e_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_a2df8e380ce56c8509007df98fce27d09}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!cutoff\-Limit@{cutoff\-Limit}}
\index{cutoff\-Limit@{cutoff\-Limit}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{cutoff\-Limit}]{\setlength{\rightskip}{0pt plus 5cm}uint32\-\_\-t Vsid\-::\-Protocol\-Model\-Db\-::cutoff\-Limit (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_1_1_protocol_model_db_a2df8e380ce56c8509007df98fce27d09}
Get the cutoff\-Limit

The cutoff limit is the maximum number of packets to look at in a flow. This is used for both classification and model creation

\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 112 of file Protocol\-Model\-Db.\-h.


\begin{DoxyCode}
112 \{ \textcolor{keywordflow}{return} \_cutoffLimit; \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a2df8e380ce56c8509007df98fce27d09_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_a9c185b6df9f6f41baa1500251c7b723b}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!database\-Version@{database\-Version}}
\index{database\-Version@{database\-Version}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{database\-Version}]{\setlength{\rightskip}{0pt plus 5cm}std\-::string Vsid\-::\-Protocol\-Model\-Db\-::database\-Version (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_1_1_protocol_model_db_a9c185b6df9f6f41baa1500251c7b723b}


Definition at line 128 of file Protocol\-Model\-Db.\-h.


\begin{DoxyCode}
128 \{ \textcolor{keywordflow}{return} \_version; \}
\end{DoxyCode}
\hypertarget{class_vsid_1_1_protocol_model_db_a511e5fdf67995099e81175a6d34d1aac}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!defining\-Limit@{defining\-Limit}}
\index{defining\-Limit@{defining\-Limit}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{defining\-Limit}]{\setlength{\rightskip}{0pt plus 5cm}uint32\-\_\-t Vsid\-::\-Protocol\-Model\-Db\-::defining\-Limit (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_1_1_protocol_model_db_a511e5fdf67995099e81175a6d34d1aac}
Get the defining limit Protocols will not be hard matched before this limit \begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 102 of file Protocol\-Model\-Db.\-h.


\begin{DoxyCode}
102 \{ \textcolor{keywordflow}{return} \_definingLimit; \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a511e5fdf67995099e81175a6d34d1aac_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_ae4c2e7652218bb11f10bf0d4d0d0257d}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!filename@{filename}}
\index{filename@{filename}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{filename}]{\setlength{\rightskip}{0pt plus 5cm}std\-::string Vsid\-::\-Protocol\-Model\-Db\-::filename (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_1_1_protocol_model_db_ae4c2e7652218bb11f10bf0d4d0d0257d}
Filename of the database \begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 118 of file Protocol\-Model\-Db.\-h.


\begin{DoxyCode}
118 \{ \textcolor{keywordflow}{return} \_filename; \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=272pt]{class_vsid_1_1_protocol_model_db_ae4c2e7652218bb11f10bf0d4d0d0257d_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_a542f3434c2a9d97ee2632200372a6a88}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!find@{find}}
\index{find@{find}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{find}]{\setlength{\rightskip}{0pt plus 5cm}std\-::shared\-\_\-ptr$<$ {\bf Protocol\-Model} $>$ Protocol\-Model\-Db\-::find (
\begin{DoxyParamCaption}
\item[{const std\-::string \&}]{name}
\end{DoxyParamCaption}
)}}\label{class_vsid_1_1_protocol_model_db_a542f3434c2a9d97ee2632200372a6a88}
Find a model by name


\begin{DoxyParams}{Parameters}
{\em name} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 508 of file Protocol\-Model\-Db.\-cpp.


\begin{DoxyCode}
509 \{
510     \textcolor{keyword}{auto} it = \_protocolModels.find(name);
511     \textcolor{keywordflow}{if}(it != \_protocolModels.end())
512         \textcolor{keywordflow}{return} it->second;
513     \textcolor{keywordflow}{else}
514         \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
515 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a542f3434c2a9d97ee2632200372a6a88_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_a4209a57665d19cc6abf920a5cfb0500c}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!front@{front}}
\index{front@{front}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{front}]{\setlength{\rightskip}{0pt plus 5cm}std\-::shared\-\_\-ptr$<$ {\bf Protocol\-Model} $>$ Protocol\-Model\-Db\-::front (
\begin{DoxyParamCaption}
\item[{uint16\-\_\-t}]{port = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}\label{class_vsid_1_1_protocol_model_db_a4209a57665d19cc6abf920a5cfb0500c}
Get the first model in the list


\begin{DoxyParams}{Parameters}
{\em port} & The port that you are looking for. 0 means default list \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 518 of file Protocol\-Model\-Db.\-cpp.


\begin{DoxyCode}
519 \{
520     \textcolor{keywordflow}{return} \hyperlink{class_vsid_1_1_protocol_model_db_a5bc72492cdde09f1bf753e0ebee26e9e}{at}(0, 0);
521 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a4209a57665d19cc6abf920a5cfb0500c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a4209a57665d19cc6abf920a5cfb0500c_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_ab7111a24bbb1c4eb6fb1a2ea61dbcaa6}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!last\-Modified\-Time@{last\-Modified\-Time}}
\index{last\-Modified\-Time@{last\-Modified\-Time}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{last\-Modified\-Time}]{\setlength{\rightskip}{0pt plus 5cm}boost\-::posix\-\_\-time\-::ptime Protocol\-Model\-Db\-::last\-Modified\-Time (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{class_vsid_1_1_protocol_model_db_ab7111a24bbb1c4eb6fb1a2ea61dbcaa6}
Time the D\-B was last modified / updated \begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 566 of file Protocol\-Model\-Db.\-cpp.


\begin{DoxyCode}
567 \{
568     \textcolor{keywordflow}{if}(\_modifiedTimes.size() > 0)
569     \{
570         \textcolor{keywordflow}{return} \_modifiedTimes[0];
571     \}
572     \textcolor{keywordflow}{else}
573     \{
574         \textcolor{keywordflow}{return} boost::posix\_time::second\_clock::universal\_time();
575     \}
576 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_ab7111a24bbb1c4eb6fb1a2ea61dbcaa6_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_a277630c01a8dc5a95ec5ded8e1e68197}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!last\-Modified\-Time\-As\-String@{last\-Modified\-Time\-As\-String}}
\index{last\-Modified\-Time\-As\-String@{last\-Modified\-Time\-As\-String}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{last\-Modified\-Time\-As\-String}]{\setlength{\rightskip}{0pt plus 5cm}std\-::string Protocol\-Model\-Db\-::last\-Modified\-Time\-As\-String (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{class_vsid_1_1_protocol_model_db_a277630c01a8dc5a95ec5ded8e1e68197}


Definition at line 578 of file Protocol\-Model\-Db.\-cpp.


\begin{DoxyCode}
579 \{
580     \textcolor{keywordflow}{return} boost::posix\_time::to\_iso\_string(\hyperlink{class_vsid_1_1_protocol_model_db_ab7111a24bbb1c4eb6fb1a2ea61dbcaa6}{lastModifiedTime}());
581 \}\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a277630c01a8dc5a95ec5ded8e1e68197_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=288pt]{class_vsid_1_1_protocol_model_db_a277630c01a8dc5a95ec5ded8e1e68197_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_ab4cdbc95950371528dea8adbc39fccef}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!read@{read}}
\index{read@{read}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}bool Protocol\-Model\-Db\-::read (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_1_1_protocol_model_db_ab4cdbc95950371528dea8adbc39fccef}
Read the protocol model from file into the database.

This can only happen once per program run and the current supported D\-B format is in Y\-A\-M\-L

\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 30 of file Protocol\-Model\-Db.\-cpp.


\begin{DoxyCode}
31 \{
32     \textcolor{keywordflow}{if}( \_initialised )
33     \{
34         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Unable to read DB because it is already initialised"});
35         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
36     \}
37 
38     \textcolor{comment}{// parse the atom/yaml...}
39     YAML::Node config;
40     \textcolor{keywordflow}{try} 
41     \{
42         std::ifstream tmp(\_filename);
43         \textcolor{keywordflow}{if} ( !tmp.good() )
44         \{
45             \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Unable to find vsid db file : "} << \_filename);
46             tmp.close();
47             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
48         \}
49         tmp.close();
50         config = YAML::LoadFile(\_filename);
51     \} 
52     \textcolor{keywordflow}{catch} (YAML::Exception& e)
53     \{
54         \hyperlink{_logger_8h_aa2ffef3c03ca18789b5d04ac9b260128}{LOG\_ERROR}(( \textcolor{stringliteral}{"Exception loading file [%v] into YAML [%v]"}, \_filename, e.what() ));
55         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
56     \}
57 
58     \textcolor{keywordflow}{try}
59     \{
60         \_definingLimit = config[\textcolor{stringliteral}{"DefiningLimit"}].as<uint32\_t>();
61         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"DefiningLimit : "} << \_definingLimit);
62 
63         \_cutoffLimit = config[\textcolor{stringliteral}{"CutoffLimit"}].as<uint32\_t>();
64         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"CutoffLimit : "} << \_cutoffLimit);
65         \textcolor{keywordflow}{if}(\_cutoffLimit > 0 && \_cutoffLimit <= \_definingLimit)
66         \{
67             \_cutoffLimit = \_definingLimit + 1;
68             \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"CutoffLimit less than DefiningLimit. Setting to : "} << \_cutoffLimit);
69         \}
70 
71         \textcolor{keywordflow}{if}( config[\textcolor{stringliteral}{"Version"}] )
72         \{
73             \_version = config[\textcolor{stringliteral}{"Version"}].as<\textcolor{keywordtype}{string}>();
74         \}
75         \textcolor{keywordflow}{else}
76         \{
77             \textcolor{comment}{// v0.1 didn't include a version}
78             \_version = \textcolor{stringliteral}{"0.1"};
79         \}
80         
81         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Version : "} << \_version);
82         \textcolor{keywordflow}{if}(\_version != \hyperlink{_protocol_model_db_8h_a92e0c4a4972115f1e9aec1a97d48eeb5}{PROTOCOL\_MODEL\_VERSION} )
83         \{
84             \textcolor{comment}{// For now just warn. In future may want to updated}
85             \hyperlink{_logger_8h_a1c6efad29ceef2a86c277eb2fbb67c85}{SLOG\_WARN}(<< \textcolor{stringliteral}{"Protocol Database versions don't match: Database ["} 
86                             << \_version << \textcolor{stringliteral}{"] : Program ["} << 
      \hyperlink{_protocol_model_db_8h_a92e0c4a4972115f1e9aec1a97d48eeb5}{PROTOCOL\_MODEL\_VERSION} << \textcolor{stringliteral}{"]"});
87         \}
88 
89         \textcolor{keywordflow}{if}( config[\textcolor{stringliteral}{"ModifiedTime"}] )
90         \{
91             \textcolor{keywordflow}{for} (YAML::const\_iterator it=config[\textcolor{stringliteral}{"ModifiedTime"}].begin(); 
92                         it!=config[\textcolor{stringliteral}{"ModifiedTime"}].end(); ++it)
93             \{
94                 \textcolor{keywordflow}{try} 
95                 \{
96                     boost::posix\_time::ptime tmp = boost::posix\_time::from\_iso\_string(it->as<std::string>()
      );
97                     \_modifiedTimes.push\_back(tmp);
98                 \}
99                 \textcolor{keywordflow}{catch}(\textcolor{keyword}{const} std::exception& ex)
100                 \{
101                     \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Caught exception processing date "} << ex.what());
102                 \}
103                 \textcolor{keywordflow}{catch}(...)
104                 \{
105                     \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Caught unknown exception processing date"} );
106                 \}
107             \}
108         \}
109         \textcolor{keywordflow}{else}
110         \{
111             \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"No modified time in DB"});
112             boost::posix\_time::ptime now = boost::posix\_time::second\_clock::universal\_time();
113             \_modifiedTimes.push\_back(now);
114 
115         \}
116 
117         \textcolor{keywordtype}{int} count = 0;
118         \textcolor{keywordtype}{int} valid = 0;
119         \textcolor{keywordflow}{for} (YAML::const\_iterator it=config[\textcolor{stringliteral}{"ProtocolModels"}].begin(); 
120                         it!=config[\textcolor{stringliteral}{"ProtocolModels"}].end(); ++it)
121         \{
122             std::shared\_ptr<ProtocolModel> model = \_readProtocolModel((*it), count);
123 
124             count++;
125 
126             \textcolor{keywordflow}{if} ( model )
127             \{
128                 valid++;
129                 
130                 \textcolor{keywordflow}{if}( \_protocolModels.find(model->name()) != \_protocolModels.end() )
131                 \{
132                     \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Model ["} << model->name() << \textcolor{stringliteral}{"] already exists in DB"})
133                     \textcolor{keywordflow}{continue};
134                 \}
135                 \_protocolModels[model->name()] = model;
136                 \_protocolModelOrder.push\_back(model);
137 
138                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < model->portHints().size(); ++i)
139                 \{
140                     \_portHintOrder[ model->portHints().at(i) ].push\_back( model );
141                 \}
142                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"Model ["} << model->name() << \textcolor{stringliteral}{"] added to DB"});
143             \}
144         \}
145     \}
146     \textcolor{keywordflow}{catch} (YAML::Exception& e)
147     \{
148         \hyperlink{_logger_8h_aa2ffef3c03ca18789b5d04ac9b260128}{LOG\_ERROR}(( \textcolor{stringliteral}{"Exception readomg file [%v] into YAML [%v]"}, \_filename, e.what() ));
149         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
150     \}
151 
152     \textcolor{keywordflow}{if}(\_protocolModelOrder.size() == 0)
153     \{
154         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"No protocol models in the DB"})
155     \}
156 
157     \textcolor{comment}{// finish filling out the port order tables}
158     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} pmIt = \_protocolModelOrder.begin(); pmIt != \_protocolModelOrder.end(); ++pmIt )
159     \{
160 
161         \textcolor{keywordflow}{for}( \textcolor{keyword}{auto} orderIt = \_portHintOrder.begin(); orderIt != \_portHintOrder.end(); ++orderIt)
162         \{
163             \textcolor{keywordtype}{bool} found = \textcolor{keyword}{false};
164             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i =0; i < orderIt->second.size(); i++)
165             \{
166                 \textcolor{keywordflow}{if}( (*pmIt)->name() == orderIt->second[i]->name() )
167                 \{
168                     found = \textcolor{keyword}{true};
169                     \textcolor{keywordflow}{break};
170                 \}
171             \}
172             \textcolor{keywordflow}{if} ( !found )
173             \{
174                 orderIt->second.push\_back((*pmIt));
175             \}
176 
177         \}
178     \}
179     
180     \textcolor{comment}{/*for( auto orderIt = \_portHintOrder.begin(); orderIt != \_portHintOrder.end(); ++orderIt)}
181 \textcolor{comment}{    \{}
182 \textcolor{comment}{        std::cout << "Order for : " << orderIt->first << endl;}
183 \textcolor{comment}{}
184 \textcolor{comment}{        for(int i =0; i < orderIt->second.size(); i++)}
185 \textcolor{comment}{        \{}
186 \textcolor{comment}{            cout << "\(\backslash\)t" << orderIt->second[i]->name() << endl;}
187 \textcolor{comment}{        \}}
188 \textcolor{comment}{    \}*/}
189             
190     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"DB Initialised"});
191     \_initialised = \textcolor{keyword}{true};
192     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
193 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_ab4cdbc95950371528dea8adbc39fccef_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_a83473d93ae3503810ce0b2ed3de19836}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!size@{size}}
\index{size@{size}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{size}]{\setlength{\rightskip}{0pt plus 5cm}size\-\_\-t Vsid\-::\-Protocol\-Model\-Db\-::size (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_1_1_protocol_model_db_a83473d93ae3503810ce0b2ed3de19836}
Get a count for the number of models

\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 95 of file Protocol\-Model\-Db.\-h.


\begin{DoxyCode}
95 \{ \textcolor{keywordflow}{return} \_protocolModelOrder.size(); \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a83473d93ae3503810ce0b2ed3de19836_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_1_1_protocol_model_db_a6555ccdf11081b5e255ee3b8d17a7ea8}{\index{Vsid\-::\-Protocol\-Model\-Db@{Vsid\-::\-Protocol\-Model\-Db}!write@{write}}
\index{write@{write}!Vsid::ProtocolModelDb@{Vsid\-::\-Protocol\-Model\-Db}}
\subsubsection[{write}]{\setlength{\rightskip}{0pt plus 5cm}bool Protocol\-Model\-Db\-::write (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_1_1_protocol_model_db_a6555ccdf11081b5e255ee3b8d17a7ea8}
Writes the current D\-B to a Y\-A\-M\-L file.

When writing will copy the old file to \-\_\-filename.\-prev

\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line 391 of file Protocol\-Model\-Db.\-cpp.


\begin{DoxyCode}
392 \{
393     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Writing protocol model db to file"});
394     YAML::Node root;
395     root[\textcolor{stringliteral}{"DefiningLimit"}] = \_definingLimit;
396     root[\textcolor{stringliteral}{"CutoffLimit"}] = \_cutoffLimit;
397     root[\textcolor{stringliteral}{"Version"}] = \hyperlink{_protocol_model_db_8h_a92e0c4a4972115f1e9aec1a97d48eeb5}{PROTOCOL\_MODEL\_VERSION};
398 
399     boost::posix\_time::ptime now = boost::posix\_time::second\_clock::universal\_time();
400 
401     \_modifiedTimes.insert(\_modifiedTimes.begin(), now);
402 
403     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < \_modifiedTimes.size(); i++)
404     \{
405         root[\textcolor{stringliteral}{"ModifiedTime"}].push\_back(boost::posix\_time::to\_iso\_string(\_modifiedTimes[i]));
406     \}
407 
408     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} it = \_protocolModelOrder.begin(); 
409                 it != \_protocolModelOrder.end(); ++it)
410     \{
411         YAML::Node ym;
412         \_writeProtocolModel(ym, (*it));
413         root[\textcolor{stringliteral}{"ProtocolModels"}].push\_back(ym);
414     \}
415 
416     YAML::Emitter out;
417     \textcolor{comment}{// more compact form }
418     out.SetMapFormat(YAML::Flow);
419     out << root;
420 
421     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"New DB : "} << endl << out.c\_str() << endl);
422 
423     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Backup file will be : "} << \_backupfile);
424 
425     \textcolor{keywordflow}{if}( std::rename(\_filename.c\_str(), \_backupfile.c\_str()) == 0)
426     \{
427         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Have moved file"});
428         ofstream file;
429         file.open (\_filename);
430         \textcolor{keywordflow}{if}(file.is\_open())
431         \{
432             file << out.c\_str();
433             file.close();
434             \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Have written new DB to "} << \_filename);
435         \}
436         \textcolor{keywordflow}{else}
437         \{
438             \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Unable to write new DB. See "} << \_backupfile << \textcolor{stringliteral}{"for DB"});
439             std::cerr << \textcolor{stringliteral}{"Unable to write new DB. See "} << \_backupfile << \textcolor{stringliteral}{"for DB"} << std::endl;
440             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
441         \}
442     \}
443     \textcolor{keywordflow}{else}
444     \{
445         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Unable to back old DB won't overwrite"});
446 
447         \textcolor{keywordtype}{string} errFile = \_filename;
448         errFile += \textcolor{stringliteral}{".new"};
449 
450         ofstream file;
451         file.open (errFile);
452         \textcolor{keywordflow}{if}(file.is\_open())
453         \{
454             file << out.c\_str();
455             file.close();
456             \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Have written new DB to "} << errFile);
457             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
458         \}
459         \textcolor{keywordflow}{else}
460         \{
461             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
462             \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Unable write new DB. See "} << errFile << \textcolor{stringliteral}{"for DB"});
463         \}
464     \}
465 
466     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
467 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_1_1_protocol_model_db_a6555ccdf11081b5e255ee3b8d17a7ea8_icgraph}
\end{center}
\end{figure}




The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
src/protocol\-\_\-model/inc/\hyperlink{_protocol_model_db_8h}{Protocol\-Model\-Db.\-h}\item 
src/protocol\-\_\-model/src/\hyperlink{_protocol_model_db_8cpp}{Protocol\-Model\-Db.\-cpp}\end{DoxyCompactItemize}
