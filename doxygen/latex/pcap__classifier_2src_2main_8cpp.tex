\hypertarget{pcap__classifier_2src_2main_8cpp}{\section{src/pcap\-\_\-classifier/src/main.cpp File Reference}
\label{pcap__classifier_2src_2main_8cpp}\index{src/pcap\-\_\-classifier/src/main.\-cpp@{src/pcap\-\_\-classifier/src/main.\-cpp}}
}
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$getopt.\-h$>$}\\*
{\ttfamily \#include $<$iostream$>$}\\*
{\ttfamily \#include $<$vector$>$}\\*
{\ttfamily \#include \char`\"{}Logger.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}Config.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}Pcap\-Reader.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}Protocol\-Model\-Db.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}Attribute\-Meter\-Registrar.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}Flow\-Classification\-Logger.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}Common\-Config.\-h\char`\"{}}\\*
Include dependency graph for main.\-cpp\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{pcap__classifier_2src_2main_8cpp__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{_logger_8h_abb52531de0e96213782908cfd2dbd677}{I\-N\-I\-T\-\_\-\-L\-O\-G\-G\-I\-N\-G} void \hyperlink{pcap__classifier_2src_2main_8cpp_ab718619364228cc1e655c32aad927bb6}{usage} (const char $\ast$command)
\item 
int \hyperlink{pcap__classifier_2src_2main_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{pcap__classifier_2src_2main_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{\index{pcap\-\_\-classifier/src/main.\-cpp@{pcap\-\_\-classifier/src/main.\-cpp}!main@{main}}
\index{main@{main}!pcap_classifier/src/main.cpp@{pcap\-\_\-classifier/src/main.\-cpp}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{pcap__classifier_2src_2main_8cpp_a0ddf1224851353fc92bfbff6f499fa97}


Definition at line 47 of file main.\-cpp.


\begin{DoxyCode}
48 \{
49     el::Loggers::addFlag(el::LoggingFlag::StrictLogFileSizeCheck);
50 
51     \textcolor{keywordtype}{string} protocol\_db;
52     \textcolor{keywordtype}{bool} protocol\_db\_set = \textcolor{keyword}{false};
53     \textcolor{keywordtype}{string} config = \textcolor{stringliteral}{"config.yaml"};
54     \textcolor{keywordtype}{string} pcap\_file;
55     \textcolor{keywordtype}{string} logging\_conf = \textcolor{stringliteral}{"../config/logging\_pcap\_classifier.conf"};
56 
57     \textcolor{keywordtype}{char} c;
58     \textcolor{keywordflow}{while} ( (c = getopt(argc, argv, \textcolor{stringliteral}{":hc:d:p:l"}) ) != -1) 
59     \{
60         \textcolor{keywordflow}{switch} (c) 
61         \{
62             \textcolor{keywordflow}{case} \textcolor{charliteral}{'d'}:
63                 protocol\_db = optarg;
64                 \textcolor{keywordflow}{break};
65             \textcolor{keywordflow}{case} \textcolor{charliteral}{'c'}:
66                 config = optarg;
67                 \textcolor{keywordflow}{break};
68             \textcolor{keywordflow}{case} \textcolor{charliteral}{'p'}:
69                 pcap\_file = optarg;
70                 \textcolor{keywordflow}{break};
71             \textcolor{keywordflow}{case} \textcolor{charliteral}{'h'}:
72                 \hyperlink{pcap__classifier_2src_2main_8cpp_ab718619364228cc1e655c32aad927bb6}{usage}(argv[0]);
73                 exit(0);
74                 \textcolor{keywordflow}{break};
75             \textcolor{keywordflow}{case} \textcolor{charliteral}{'l'}:
76                 logging\_conf = optarg;
77                 \textcolor{keywordflow}{break};
78             \textcolor{keywordflow}{case} \textcolor{charliteral}{':'}:
79                 cerr << \textcolor{stringliteral}{"ERROR: Option "} << (char)optopt << \textcolor{stringliteral}{" requires an argument."} << endl;
80                 \hyperlink{pcap__classifier_2src_2main_8cpp_ab718619364228cc1e655c32aad927bb6}{usage}(argv[0]);
81                 exit(1);
82                 \textcolor{keywordflow}{break};
83             \textcolor{keywordflow}{case} \textcolor{charliteral}{'?'}:
84             \textcolor{keywordflow}{default}:
85                 cerr << \textcolor{stringliteral}{"ERROR: Unrecognised Option : "} << (char)optopt << endl;
86                 \hyperlink{pcap__classifier_2src_2main_8cpp_ab718619364228cc1e655c32aad927bb6}{usage}(argv[0]);
87                 exit(1);
88                 \textcolor{keywordflow}{break};
89         \}
90     \}
91 
92     el::Configurations conf(logging\_conf); 
93     el::Loggers::reconfigureAllLoggers(conf);
94 
95     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << endl 
96                 << \textcolor{stringliteral}{"\(\backslash\)t\(\backslash\)t
      +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+"} << endl
97                 << \textcolor{stringliteral}{"\(\backslash\)t\(\backslash\)t+ Running "} << argv[0] << endl
98                 << \textcolor{stringliteral}{"\(\backslash\)t\(\backslash\)t
      +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+"} << endl);
99 
100 
101     \hyperlink{_attribute_meter_registrar_8h_acc628170f0b90d7876378e03d3159647}{init\_attribute\_meters}();
102 
103     std::ifstream tmp(pcap\_file);
104     \textcolor{keywordflow}{if} ( !tmp.good() )
105     \{
106         \hyperlink{_logger_8h_aa2ffef3c03ca18789b5d04ac9b260128}{LOG\_ERROR}((\textcolor{stringliteral}{"Unable to find pcap file : %v"}, pcap\_file));
107         cerr << \textcolor{stringliteral}{"ERROR: Unable to find pcap file : "} << pcap\_file << endl;
108         exit(1);
109     \}
110 
111     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"config file : "} << config);
112 
113     \textcolor{keywordflow}{if} ( !Config::instance()->init(config) )
114     \{
115         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Unable to initialise configuration"});
116         cerr << \textcolor{stringliteral}{"ERROR: Unable to initialise configuration"} << endl;
117         exit(1);
118     \}
119 
120     \textcolor{keywordflow}{if}( !protocol\_db.empty() )
121     \{
122         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"overriding protocol\_db from config : "} << protocol\_db); 
123         Config::instance()->protocolDatabase(protocol\_db);
124     \}
125 
126     \textcolor{keywordflow}{if}(Config::instance()->protocolDatabase().empty())
127     \{
128         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"No spid database configured"})
129         cerr << "No spid database configured" << endl;
130         exit(1);
131     \}
132 
133     \hyperlink{class_vsid_1_1_protocol_model_db}{ProtocolModelDb} protocolModelDb(\hyperlink{class_vsid_pcap_classifier_1_1_config}{Config}::instance()->protocolDatabase(), "" );
134     
135     if( !protocolModelDb.read() )
136     \{
137         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Unable to read DB at ["} << Config::instance()->protocolDatabase() << \textcolor{stringliteral}{"]"})
138         cerr << "Unable to read DB at [" << \hyperlink{class_vsid_pcap_classifier_1_1_config}{Config}::instance()->protocolDatabase() << "]" << endl;
139         exit(1);
140     \}
141 
142     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< "spid database : " << \hyperlink{class_vsid_pcap_classifier_1_1_config}{Config}::instance()->protocolDatabase());
143 
144     \hyperlink{class_vsid_common_1_1_flow_manager}{FlowManager} flowManager(&protocolModelDb);
145     flowManager.init();
146 
147     \hyperlink{class_vsid_pcap_classifier_1_1_pcap_reader}{PcapReader} reader(&flowManager);
148 
149     \textcolor{comment}{// Start the trace file for classification}
150     \hyperlink{_logger_8h_a92056d6f812b14acf33d9e27b9b1f157}{SLOG\_TRACE}( << "---"
151                 << std::endl
152                 << "ProtocolDatabase: \{\textcolor{stringliteral}{" }
153 \textcolor{stringliteral}{                << "}FileName: \textcolor{stringliteral}{" << protocolModelDb.filename() }
154 \textcolor{stringliteral}{                << "}, LastModifiedTime: \textcolor{stringliteral}{" << protocolModelDb.lastModifiedTimeAsString()}
155 \textcolor{stringliteral}{                << "}, CutoffLimit: \textcolor{stringliteral}{" << protocolModelDb.cutoffLimit()}
156 \textcolor{stringliteral}{                << "}, DefiningLimit: \textcolor{stringliteral}{" << protocolModelDb.definingLimit()}
157 \textcolor{stringliteral}{                << "}\}\textcolor{stringliteral}{" << std::endl}
158 \textcolor{stringliteral}{                << "}KLDivergenceThreshold: \textcolor{stringliteral}{" << CommonConfig::instance()->divergenceThreshold() <<
       std::endl}
159 \textcolor{stringliteral}{                << "}Input: \(\backslash\)\textcolor{stringliteral}{""} << pcap\_file << \textcolor{stringliteral}{"\(\backslash\)""} << std::endl
160                 << \textcolor{stringliteral}{"Results: "});
161 
162     \hyperlink{class_vsid_common_1_1_flow_classification_logger}{FlowClassificationLogger} fcLogger(&flowManager);
163 
164     \textcolor{keywordflow}{if} ( !reader.read(pcap\_file) )
165     \{
166         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Unable to read pcap ["} << pcap\_file << \textcolor{stringliteral}{"]"});
167     \}
168     \textcolor{keywordflow}{else}
169     \{
170         flowManager.finished();
171     \}
172 
173     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Finished program"})
174 \}\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{pcap__classifier_2src_2main_8cpp_a0ddf1224851353fc92bfbff6f499fa97_cgraph}
\end{center}
\end{figure}


\hypertarget{pcap__classifier_2src_2main_8cpp_ab718619364228cc1e655c32aad927bb6}{\index{pcap\-\_\-classifier/src/main.\-cpp@{pcap\-\_\-classifier/src/main.\-cpp}!usage@{usage}}
\index{usage@{usage}!pcap_classifier/src/main.cpp@{pcap\-\_\-classifier/src/main.\-cpp}}
\subsubsection[{usage}]{\setlength{\rightskip}{0pt plus 5cm}{\bf I\-N\-I\-T\-\_\-\-L\-O\-G\-G\-I\-N\-G} void usage (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{command}
\end{DoxyParamCaption}
)}}\label{pcap__classifier_2src_2main_8cpp_ab718619364228cc1e655c32aad927bb6}


Definition at line 33 of file main.\-cpp.


\begin{DoxyCode}
34 \{
35     cout << endl << gvProgramName <<  endl << endl;
36     cout << \textcolor{stringliteral}{"Usage : "} << command << \textcolor{stringliteral}{" [-h] [-c <config\_file>] [-d database\_file] -p pcap file"};
37     cout << \textcolor{stringliteral}{"Options :"} << endl 
38         << \textcolor{stringliteral}{" -c \(\backslash\)t Config file "} << endl
39         << \textcolor{stringliteral}{" -l \(\backslash\)t Logging Config "} << endl
40         << \textcolor{stringliteral}{" -d \(\backslash\)t VSI SPID database file. Overrides the one from config file"} << endl
41         << \textcolor{stringliteral}{" -p \(\backslash\)t PCAP file which to read"} << endl
42         << \textcolor{stringliteral}{" -h \(\backslash\)t print this help and exit"} << endl;
43 
44 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=274pt]{pcap__classifier_2src_2main_8cpp_ab718619364228cc1e655c32aad927bb6_icgraph}
\end{center}
\end{figure}


