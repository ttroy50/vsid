\hypertarget{class_vsid_netfilter_1_1_packet_handler}{\section{Vsid\-Netfilter\-:\-:Packet\-Handler Class Reference}
\label{class_vsid_netfilter_1_1_packet_handler}\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
}


{\ttfamily \#include $<$Packet\-Handler.\-h$>$}



Inheritance diagram for Vsid\-Netfilter\-:\-:Packet\-Handler\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{class_vsid_netfilter_1_1_packet_handler__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for Vsid\-Netfilter\-:\-:Packet\-Handler\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{class_vsid_netfilter_1_1_packet_handler__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_vsid_netfilter_1_1_packet_handler_ad5cc80ce9ffd9d456d4578ddf2bc957c}{Packet\-Handler} (int \hyperlink{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}{queue\-Number}, \hyperlink{class_vsid_1_1_protocol_model_db}{Vsid\-::\-Protocol\-Model\-Db} $\ast$database)
\item 
\hyperlink{class_vsid_netfilter_1_1_packet_handler_a8630d1f47ddece6dfb17b85faf564243}{$\sim$\-Packet\-Handler} ()
\item 
void \hyperlink{class_vsid_netfilter_1_1_packet_handler_a351a43a68f29a0f19a7baccebe1397e9}{run} ()
\item 
bool \hyperlink{class_vsid_netfilter_1_1_packet_handler_a348aa5a48468fd46ec5ecff507d51e24}{handle\-Packet} (struct nfq\-\_\-q\-\_\-handle $\ast$nf\-Queue, struct nfgenmsg $\ast$msg, struct nfq\-\_\-data $\ast$pkt)
\item 
void \hyperlink{class_vsid_netfilter_1_1_packet_handler_acba4a3d934d515a3a867c008b3c909a7}{shutdown} ()
\item 
int \hyperlink{class_vsid_netfilter_1_1_packet_handler_abb5ca3f313ceaed495dd06ce56bdf849}{set\-Verdict} (uint32\-\_\-t id, uint32\-\_\-t verdict)
\item 
int \hyperlink{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}{set\-Verdict\-Local} (uint32\-\_\-t id, uint32\-\_\-t verdict)
\item 
int \hyperlink{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}{queue\-Number} ()
\item 
uint64\-\_\-t \hyperlink{class_vsid_netfilter_1_1_packet_handler_a1d9601d06fe28b986213d951645f90e9}{num\-Packets} ()
\item 
std\-::vector$<$ uint64\-\_\-t $>$ \hyperlink{class_vsid_netfilter_1_1_packet_handler_aa73cd1027b67da5a9b4526a08065decf}{verdict\-Stats} ()
\item 
size\-\_\-t \hyperlink{class_vsid_netfilter_1_1_packet_handler_ad0ecdcdf9a4aaa5ea4a55a404b43ef12}{open\-Flows} ()
\item 
virtual void \hyperlink{class_vsid_netfilter_1_1_packet_handler_a40ff7c9f8bdbfa5bfe6b1ca94edd2f04}{set\-Accept} (uint32\-\_\-t id)
\item 
virtual void \hyperlink{class_vsid_netfilter_1_1_packet_handler_ad0a799dbbe9a3e6e6310a4d303710aa1}{set\-Drop} (uint32\-\_\-t id)
\item 
\hyperlink{class_vsid_netfilter_1_1_packet_handler_a6a49b7914eaa9befb525446d5f447c7e}{Packet\-Handler} (int \hyperlink{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}{queue\-Number})
\item 
\hyperlink{class_vsid_netfilter_1_1_packet_handler_a0789067780b2d1d432a61fc675ec4db5}{$\sim$\-Packet\-Handler} ()
\item 
void \hyperlink{class_vsid_netfilter_1_1_packet_handler_a94f2a8768ddc7c1c492ce37304edb965}{run} ()
\item 
bool \hyperlink{class_vsid_netfilter_1_1_packet_handler_ada216d665b6f10fdd32442d3dd2634f3}{handle\-Packet} (struct nfq\-\_\-q\-\_\-handle $\ast$nf\-Queue, struct nfgenmsg $\ast$msg, struct nfq\-\_\-data $\ast$pkt)
\item 
void \hyperlink{class_vsid_netfilter_1_1_packet_handler_a2296b558ff874f5ddc27e9deecc7bd85}{shutdown} ()
\item 
int \hyperlink{class_vsid_netfilter_1_1_packet_handler_afc60de8576a1b1543b8e6b6f9fcca801}{set\-Verdict} (uint32\-\_\-t id, uint32\-\_\-t verdict)
\item 
int \hyperlink{class_vsid_netfilter_1_1_packet_handler_a7e8b3ee2c5447a74b41d8fe190c162d0}{set\-Verdict\-Local} (uint32\-\_\-t id, uint32\-\_\-t verdict)
\item 
int \hyperlink{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}{queue\-Number} ()
\item 
uint64\-\_\-t \hyperlink{class_vsid_netfilter_1_1_packet_handler_a1d9601d06fe28b986213d951645f90e9}{num\-Packets} ()
\item 
std\-::vector$<$ uint64\-\_\-t $>$ \hyperlink{class_vsid_netfilter_1_1_packet_handler_a7a9ae496da5a2eabeeeb2341eb107590}{verdict\-Stats} ()
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 35 of file Packet\-Handler.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_ad5cc80ce9ffd9d456d4578ddf2bc957c}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!Packet\-Handler@{Packet\-Handler}}
\index{Packet\-Handler@{Packet\-Handler}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{Packet\-Handler}]{\setlength{\rightskip}{0pt plus 5cm}Packet\-Handler\-::\-Packet\-Handler (
\begin{DoxyParamCaption}
\item[{int}]{queue\-Number, }
\item[{{\bf Vsid\-::\-Protocol\-Model\-Db} $\ast$}]{database}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_ad5cc80ce9ffd9d456d4578ddf2bc957c}


Definition at line 66 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
66                                                                        :
67     \_shutdown(\textcolor{keyword}{false}),
68     \_numPackets(0),
69     \_verdictStats(NF\_MAX\_VERDICT, 0),
70     \_prococolModelDb(database),
71     \_flowManager(database),
72     \_fcLogger(&\_flowManager)
73 \{
74     \_flowManager.\hyperlink{class_vsid_common_1_1_flow_manager_a49fc9f26f20cb8b963dcf28a704f5861}{init}();
75 
76     \_queueNumber = \hyperlink{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}{queueNumber};
77     \_nfqHandle = NULL;
78     \_nfQueue = NULL;
79     \_netlinkHandle = NULL;
80 
81     \textcolor{comment}{// Get a queue connection handle from the module}
82     \textcolor{keywordflow}{if} (!(\_nfqHandle = nfq\_open())) 
83     \{
84         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_open()"} );
85         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_open()"});
86     \}
87 
88     \textcolor{comment}{// Unbind the handler from processing any IP packets}
89     \textcolor{keywordflow}{if} (nfq\_unbind\_pf(\_nfqHandle, AF\_INET) < 0) 
90     \{
91         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_unbind\_pf()"} );
92         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_unbind\_pf()"});
93     \}
94 
95     \textcolor{comment}{// Bind this handler to process IP packets...}
96     \textcolor{comment}{// We only care about IPv4 in initial version}
97     \textcolor{keywordflow}{if} (nfq\_bind\_pf(\_nfqHandle, AF\_INET) < 0) 
98     \{
99         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_bind\_pf()"} );
100         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_bind\_pf()"});
101     \}
102 
103     \_nfQueue = nfq\_create\_queue(\_nfqHandle, \_queueNumber, &nfqPacketHandlerCb, static\_cast<void*>(\textcolor{keyword}{this}) );
104     \textcolor{keywordflow}{if} (\_nfQueue == NULL) 
105     \{
106         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_create\_queue() : "} << \_queueNumber << \textcolor{stringliteral}{" : err = "} << 
      nfq\_errno);
107         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_create\_queue()"});
108     \}
109 
110     \textcolor{comment}{// Turn on packet copy mode}
111     \textcolor{keywordflow}{if} (nfq\_set\_mode(\_nfQueue, NFQNL\_COPY\_PACKET, \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->nfBufSize()) < 0) 
112     \{
113         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Could not set packet copy mode"} );
114         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_set\_mode()"});
115     \}
116 
117 
118     \textcolor{keywordflow}{if} (nfq\_set\_queue\_maxlen(\_nfQueue, \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->nfQueueSize()) < 0)
119     \{
120         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Could not resize nfQueue"} );
121         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_set\_queue\_maxlen()"});
122     \}
123 
124     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Queue setup for ["} << \_queueNumber << \textcolor{stringliteral}{"]"});
125 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_ad5cc80ce9ffd9d456d4578ddf2bc957c_cgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_a8630d1f47ddece6dfb17b85faf564243}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!$\sim$\-Packet\-Handler@{$\sim$\-Packet\-Handler}}
\index{$\sim$\-Packet\-Handler@{$\sim$\-Packet\-Handler}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{$\sim$\-Packet\-Handler}]{\setlength{\rightskip}{0pt plus 5cm}Packet\-Handler\-::$\sim$\-Packet\-Handler (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a8630d1f47ddece6dfb17b85faf564243}


Definition at line 127 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
128 \{
129     \textcolor{keywordflow}{if}(\_nfQueue)
130     \{
131         nfq\_destroy\_queue(\_nfQueue);
132     \}
133 
134     
135     \textcolor{keywordflow}{if}(\_netlinkHandle)
136     \{
137         nfq\_close(\_nfqHandle);
138         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Queue close for ["} << \_queueNumber << \textcolor{stringliteral}{"]"});
139     \}
140 \}
\end{DoxyCode}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a6a49b7914eaa9befb525446d5f447c7e}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!Packet\-Handler@{Packet\-Handler}}
\index{Packet\-Handler@{Packet\-Handler}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{Packet\-Handler}]{\setlength{\rightskip}{0pt plus 5cm}Packet\-Handler\-::\-Packet\-Handler (
\begin{DoxyParamCaption}
\item[{int}]{queue\-Number}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a6a49b7914eaa9befb525446d5f447c7e}


Definition at line 65 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
65                                              :
66     \_shutdown(\textcolor{keyword}{false}),
67     \_numPackets(0),
68     \_verdictStats(NF\_MAX\_VERDICT, 0)
69 \{
70     \_queueNumber = \hyperlink{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}{queueNumber};
71     \_nfqHandle = NULL;
72     \_nfQueue = NULL;
73     \_netlinkHandle = NULL;
74 
75     \textcolor{comment}{// Get a queue connection handle from the module}
76     \textcolor{keywordflow}{if} (!(\_nfqHandle = nfq\_open())) 
77     \{
78         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_open()"} );
79         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_open()"});
80     \}
81 
82     \textcolor{comment}{// Unbind the handler from processing any IP packets}
83     \textcolor{keywordflow}{if} (nfq\_unbind\_pf(\_nfqHandle, AF\_INET) < 0) 
84     \{
85         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_unbind\_pf()"} );
86         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_unbind\_pf()"});
87     \}
88 
89     \textcolor{comment}{// Bind this handler to process IP packets...}
90     \textcolor{comment}{// We only care about IPv4 in initial version}
91     \textcolor{keywordflow}{if} (nfq\_bind\_pf(\_nfqHandle, AF\_INET) < 0) 
92     \{
93         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_bind\_pf()"} );
94         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_bind\_pf()"});
95     \}
96 
97     \_nfQueue = nfq\_create\_queue(\_nfqHandle, \_queueNumber, &nfqPacketHandlerCb, static\_cast<void*>(\textcolor{keyword}{this}) );
98     \textcolor{keywordflow}{if} (\_nfQueue == NULL) 
99     \{
100         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_create\_queue() : "} << \_queueNumber << \textcolor{stringliteral}{" : err = "} << 
      nfq\_errno);
101         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_create\_queue()"});
102     \}
103 
104     \textcolor{comment}{// Turn on packet copy mode}
105     \textcolor{keywordflow}{if} (nfq\_set\_mode(\_nfQueue, NFQNL\_COPY\_PACKET, \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->nfBufSize()) < 0) 
106     \{
107         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Could not set packet copy mode"} );
108         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_set\_mode()"});
109     \}
110 
111 
112     \textcolor{keywordflow}{if} (nfq\_set\_queue\_maxlen(\_nfQueue, \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->nfQueueSize()) < 0)
113     \{
114         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Could not resize nfQueue"} );
115         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"Error in nfq\_set\_queue\_maxlen()"});
116     \}
117 
118     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Queue setup for ["} << \_queueNumber << \textcolor{stringliteral}{"]"});
119 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_a6a49b7914eaa9befb525446d5f447c7e_cgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_a0789067780b2d1d432a61fc675ec4db5}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!$\sim$\-Packet\-Handler@{$\sim$\-Packet\-Handler}}
\index{$\sim$\-Packet\-Handler@{$\sim$\-Packet\-Handler}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{$\sim$\-Packet\-Handler}]{\setlength{\rightskip}{0pt plus 5cm}Vsid\-Netfilter\-::\-Packet\-Handler\-::$\sim$\-Packet\-Handler (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a0789067780b2d1d432a61fc675ec4db5}


\subsection{Member Function Documentation}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a348aa5a48468fd46ec5ecff507d51e24}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!handle\-Packet@{handle\-Packet}}
\index{handle\-Packet@{handle\-Packet}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{handle\-Packet}]{\setlength{\rightskip}{0pt plus 5cm}bool Packet\-Handler\-::handle\-Packet (
\begin{DoxyParamCaption}
\item[{struct nfq\-\_\-q\-\_\-handle $\ast$}]{nf\-Queue, }
\item[{struct nfgenmsg $\ast$}]{msg, }
\item[{struct nfq\-\_\-data $\ast$}]{pkt}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a348aa5a48468fd46ec5ecff507d51e24}


Definition at line 262 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
265 \{
266     \_numPackets++;
267 
268     uint32\_t \textcolor{keywordtype}{id} = 0;
269 
270     nfqnl\_msg\_packet\_hdr *header = nfq\_get\_msg\_packet\_hdr(pkt);
271     \textcolor{keywordflow}{if} (header) 
272     \{
273         \textcolor{keywordtype}{id} = ntohl(header->packet\_id);
274     \}
275 
276     timeval timestamp;
277     \textcolor{keywordflow}{if} (nfq\_get\_timestamp(pkt, &timestamp) != 0) 
278     \{
279         \textcolor{comment}{// We can't guarentee a timestamp messages on the OUTPUT queue.}
280         \textcolor{comment}{// For now just pop the current time into the timeval}
281         \textcolor{comment}{// Should be ok because we onlu use time for UDP connection tracking ??}
282         gettimeofday(&timestamp, NULL);
283     \}
284 
285     u\_char *pktData;
286     \textcolor{keywordtype}{int} pktLen = nfq\_get\_payload(pkt, &pktData);
287 
288     \textcolor{comment}{//SLOG\_INFO( << "Packet len is " << pktLen );}
289     \textcolor{comment}{//if(pktLen > 0)}
290     \textcolor{comment}{//\{}
291     \textcolor{comment}{//      LOG\_HEXDUMP("data :", pktData, pktLen);}
292     \textcolor{comment}{//\}}
293 
294     \textcolor{keyword}{struct }ip\_vhl \{
295         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ip\_hl:4; \textcolor{comment}{// only in IPv4}
296         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ip\_v:4;
297     \};  
298 
299     \textcolor{comment}{// IP Header}
300     \textcolor{keyword}{const} u\_char* ip\_hdr\_start = pktData;
301 
302     ip\_vhl* vhl = (\textcolor{keyword}{struct }ip\_vhl*)(ip\_hdr\_start);
303 
304     \textcolor{keywordflow}{if}(vhl->ip\_v == IPv4)
305     \{
306         \textcolor{keyword}{struct }iphdr* ip\_hdr = (\textcolor{keyword}{struct }iphdr*)(ip\_hdr\_start);
307         \textcolor{keyword}{const} u\_char* transport\_hdr\_start = ip\_hdr\_start + (vhl->ip\_hl * 4);
308 
309         \textcolor{comment}{// extract the source and the destination ip-adrress}
310         in\_addr* srcIp = (in\_addr*) &ip\_hdr->saddr;
311         in\_addr* dstIp = (in\_addr*) &ip\_hdr->daddr;
312 
313         \textcolor{keywordtype}{char} src[INET6\_ADDRSTRLEN];
314         inet\_ntop(AF\_INET, srcIp, src, INET6\_ADDRSTRLEN);
315 
316         \textcolor{keywordtype}{char} dst[INET6\_ADDRSTRLEN];
317         inet\_ntop(AF\_INET, dstIp, dst, INET6\_ADDRSTRLEN);
318 
319         \textcolor{comment}{// Transport Layer Header}
320         \textcolor{keywordflow}{switch}(ip\_hdr->protocol)
321         \{
322             \textcolor{keywordflow}{case} IPPROTO\_ICMP:
323             \{
324                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"IPPROTO\_ICMP"});
325                 \textcolor{keywordflow}{return} \hyperlink{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}{setVerdictLocal}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
326             \}
327             \textcolor{keywordflow}{case} IPPROTO\_TCP:
328             \{
329                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"IPPROTO\_TCP : pktid=["} << \textcolor{keywordtype}{id} << \textcolor{stringliteral}{"]"});
330 
331                 \textcolor{keyword}{struct }tcphdr* tcph = (\textcolor{keyword}{struct }tcphdr*)(transport\_hdr\_start);
332 
333                 \textcolor{keyword}{const} u\_char* data\_start = transport\_hdr\_start  + tcph->doff * 4;
334                 
335                 \hyperlink{class_vsid_common_1_1_tcp_i_pv4}{TcpIPv4}* tcp = \textcolor{keyword}{new} \hyperlink{class_vsid_common_1_1_tcp_i_pv4}{TcpIPv4}(pktData, 
336                                         pktLen, 
337                                         ip\_hdr\_start, 
338                                         transport\_hdr\_start, 
339                                         data\_start, 
340                                         timestamp, 
341                                         \_buffer,
342                                         \textcolor{keywordtype}{id},
343                                         \textcolor{keyword}{this});
344 
345                 \textcolor{keywordflow}{if}( !\hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->verdictAfterClassification() )
346                 \{
347                     \textcolor{comment}{// We don't care about the verdict so set it now.}
348                     \hyperlink{class_vsid_netfilter_1_1_packet_handler_abb5ca3f313ceaed495dd06ce56bdf849}{setVerdict}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
349                 \}
350 
351                 \_flowManager.\hyperlink{class_vsid_common_1_1_flow_manager_a9c840fe2a6650079a3b90ba2d65f1e7e}{addPacket}(tcp);
352 
353                 
354                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};
355             \}
356             \textcolor{keywordflow}{case} IPPROTO\_UDP:
357             \{
358                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"IPPROTO\_UDP : pktid=["} << \textcolor{keywordtype}{id} << \textcolor{stringliteral}{"]"});
359 
360                 \textcolor{keyword}{const} u\_char* data\_start = transport\_hdr\_start + \textcolor{keyword}{sizeof}(udphdr);
361 
362                 \hyperlink{class_vsid_common_1_1_udp_i_pv4}{UdpIPv4}* udp = \textcolor{keyword}{new} \hyperlink{class_vsid_common_1_1_udp_i_pv4}{UdpIPv4}(pktData, 
363                                         pktLen, 
364                                         ip\_hdr\_start, 
365                                         transport\_hdr\_start, 
366                                         data\_start, 
367                                         timestamp, 
368                                         \_buffer,
369                                         \textcolor{keywordtype}{id},
370                                         \textcolor{keyword}{this});
371 
372 
373                 \textcolor{keywordflow}{if}( !\hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->verdictAfterClassification() )
374                 \{
375                     \textcolor{comment}{// We don't care about the verdict so set it now.}
376                     \hyperlink{class_vsid_netfilter_1_1_packet_handler_abb5ca3f313ceaed495dd06ce56bdf849}{setVerdict}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
377                 \}
378 
379                 \_flowManager.\hyperlink{class_vsid_common_1_1_flow_manager_a9c840fe2a6650079a3b90ba2d65f1e7e}{addPacket}(udp);
380 
381                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};
382             \}
383             \textcolor{keywordflow}{case} IPPROTO\_SCTP:
384             \{
385                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"IPPROTO\_SCTP"});
386                 \textcolor{keywordflow}{return} \hyperlink{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}{setVerdictLocal}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
387             \}
388             \textcolor{keywordflow}{default}:
389             \{
390                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"UNKNOWN IPPROTO : "} << ip\_hdr->protocol);
391                 \textcolor{keywordflow}{return} \hyperlink{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}{setVerdictLocal}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
392             \}
393 
394         \}
395     \}
396     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(vhl->ip\_v == IPv6)
397     \{
398         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"IP Version 6 not supported yet"})
399         return \hyperlink{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}{setVerdictLocal}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
400     \}
401     else
402     \{
403         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Invalid IP Version : "} << vhl->ip\_v)
404         return \hyperlink{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}{setVerdictLocal}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
405     \}
406 
407     return \hyperlink{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}{setVerdictLocal}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
408 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_a348aa5a48468fd46ec5ecff507d51e24_cgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_ada216d665b6f10fdd32442d3dd2634f3}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!handle\-Packet@{handle\-Packet}}
\index{handle\-Packet@{handle\-Packet}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{handle\-Packet}]{\setlength{\rightskip}{0pt plus 5cm}bool Vsid\-Netfilter\-::\-Packet\-Handler\-::handle\-Packet (
\begin{DoxyParamCaption}
\item[{struct nfq\-\_\-q\-\_\-handle $\ast$}]{nf\-Queue, }
\item[{struct nfgenmsg $\ast$}]{msg, }
\item[{struct nfq\-\_\-data $\ast$}]{pkt}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_ada216d665b6f10fdd32442d3dd2634f3}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a1d9601d06fe28b986213d951645f90e9}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!num\-Packets@{num\-Packets}}
\index{num\-Packets@{num\-Packets}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{num\-Packets}]{\setlength{\rightskip}{0pt plus 5cm}uint64\-\_\-t Vsid\-Netfilter\-::\-Packet\-Handler\-::num\-Packets (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_netfilter_1_1_packet_handler_a1d9601d06fe28b986213d951645f90e9}


Definition at line 57 of file Packet\-Handler.\-h.


\begin{DoxyCode}
57 \{ \textcolor{keywordflow}{return} \_numPackets; \}
\end{DoxyCode}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a1d9601d06fe28b986213d951645f90e9}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!num\-Packets@{num\-Packets}}
\index{num\-Packets@{num\-Packets}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{num\-Packets}]{\setlength{\rightskip}{0pt plus 5cm}uint64\-\_\-t Vsid\-Netfilter\-::\-Packet\-Handler\-::num\-Packets (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_netfilter_1_1_packet_handler_a1d9601d06fe28b986213d951645f90e9}


Definition at line 57 of file Packet\-Handler.\-h.


\begin{DoxyCode}
57 \{ \textcolor{keywordflow}{return} \_numPackets; \}
\end{DoxyCode}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_ad0ecdcdf9a4aaa5ea4a55a404b43ef12}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!open\-Flows@{open\-Flows}}
\index{open\-Flows@{open\-Flows}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{open\-Flows}]{\setlength{\rightskip}{0pt plus 5cm}size\-\_\-t Packet\-Handler\-::open\-Flows (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_ad0ecdcdf9a4aaa5ea4a55a404b43ef12}


Definition at line 430 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
431 \{
432     \textcolor{keywordflow}{return} \_flowManager.\hyperlink{class_vsid_common_1_1_flow_manager_aabf9d276ad8e588573805ac40160e108}{numFlows}();
433 \}\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_ad0ecdcdf9a4aaa5ea4a55a404b43ef12_cgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!queue\-Number@{queue\-Number}}
\index{queue\-Number@{queue\-Number}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{queue\-Number}]{\setlength{\rightskip}{0pt plus 5cm}int Vsid\-Netfilter\-::\-Packet\-Handler\-::queue\-Number (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}


Definition at line 56 of file Packet\-Handler.\-h.


\begin{DoxyCode}
56 \{ \textcolor{keywordflow}{return} \_queueNumber; \}
\end{DoxyCode}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!queue\-Number@{queue\-Number}}
\index{queue\-Number@{queue\-Number}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{queue\-Number}]{\setlength{\rightskip}{0pt plus 5cm}int Vsid\-Netfilter\-::\-Packet\-Handler\-::queue\-Number (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58}


Definition at line 56 of file Packet\-Handler.\-h.


\begin{DoxyCode}
56 \{ \textcolor{keywordflow}{return} \_queueNumber; \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_a0ae07d1e28782fae0302f9e09e3dbf58_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_a351a43a68f29a0f19a7baccebe1397e9}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!run@{run}}
\index{run@{run}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{run}]{\setlength{\rightskip}{0pt plus 5cm}void Packet\-Handler\-::run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a351a43a68f29a0f19a7baccebe1397e9}


Definition at line 143 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
144 \{
145     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"Entering event loop for PacketHandler : Queue ["} << \_queueNumber << \textcolor{stringliteral}{"]"})
146 
147     if(!\_nfqHandle || !\_nfQueue )
148     \{
149         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Not setup correctly ["} << \_queueNumber << \textcolor{stringliteral}{"]"});
150         \textcolor{keywordflow}{throw} \hyperlink{class_vsid_common_1_1_string_exception}{StringException}(\textcolor{stringliteral}{"PacketHandler not constructed correctly"});
151     \}
152 
153     \textcolor{keywordtype}{int} fd; 
154     \textcolor{keywordtype}{int} res;
155     
156     \_netlinkHandle = nfq\_nfnlh(\_nfqHandle);
157 
158     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"netlinkHandle : "} << \_netlinkHandle);
159     nfnl\_rcvbufsiz(\_netlinkHandle, \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->nfQueueSize() * 
      \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->nfBufSize());
160 
161     fd = nfnl\_fd(\_netlinkHandle);
162 
163     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"fd ["} << fd << \textcolor{stringliteral}{"] on queue ["} << \_queueNumber << \textcolor{stringliteral}{"]"});
164 
165     \textcolor{keyword}{struct }timeval timeout;
166     \textcolor{comment}{// TODO maybe make configurable}
167     timeout.tv\_sec = 1; 
168     timeout.tv\_usec = 0; 
169 
170     \textcolor{comment}{// Set a timeout on the socket so we can shutdown the thread}
171     res = setsockopt(fd, SOL\_SOCKET, SO\_RCVTIMEO, (\textcolor{keywordtype}{char} *)&timeout, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} timeval));
172 
173     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"result of setting SO\_RCVTIMEO ["} << res << \textcolor{stringliteral}{"]"})
174 
175     while (!\_shutdown) 
176     \{
177         \textcolor{comment}{// TODO mempory pool to not do a malloc every packet}
178         \_buffer = \textcolor{keyword}{new} u\_char[\hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->\hyperlink{class_vsid_netfilter_1_1_config_a6873a15c546f7178ac6a66c06166c840}{nfBufSize}()];
179         \textcolor{keywordflow}{if}(\_buffer == NULL)
180         \{
181             \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Unable to allocate buffer for recv"});
182             \textcolor{keywordflow}{continue};
183         \}
184 
185         res = recv(fd, \_buffer, \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->nfBufSize(), 0);
186 
187         \textcolor{keywordflow}{if}(res >= 0)
188         \{
189             nfq\_handle\_packet(\_nfqHandle, (\textcolor{keywordtype}{char}*)\_buffer, res);
190         \}
191         \textcolor{keywordflow}{else}
192         \{
193             \textcolor{keyword}{delete} \_buffer;
194             \_buffer = NULL;
195             \textcolor{keywordflow}{if}(errno != EAGAIN )
196             \{
197                 \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"errno ["} << errno << \textcolor{stringliteral}{"]["} << strerror(errno) << \textcolor{stringliteral}{"] res is ["} << 
      res << \textcolor{stringliteral}{"]. Shutting down"});
198                 \_shutdown = \textcolor{keyword}{true};
199             \}
200         \}
201     \}
202 
203     \textcolor{comment}{// Bind this handler to process IP packets...}
204     \textcolor{comment}{// We only care about IPv4 in initial version}
205     \textcolor{keywordflow}{if} (nfq\_unbind\_pf(\_nfqHandle, AF\_INET) < 0) 
206     \{
207         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Error in nfq\_unbind\_pf()"} );
208     \}
209 
210     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"finished with queue ["} << \_queueNumber << \textcolor{stringliteral}{"] after ["} 
211                 << \_numPackets << \textcolor{stringliteral}{"] packets"});
212 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_a351a43a68f29a0f19a7baccebe1397e9_cgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_a94f2a8768ddc7c1c492ce37304edb965}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!run@{run}}
\index{run@{run}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{run}]{\setlength{\rightskip}{0pt plus 5cm}void Vsid\-Netfilter\-::\-Packet\-Handler\-::run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a94f2a8768ddc7c1c492ce37304edb965}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a40ff7c9f8bdbfa5bfe6b1ca94edd2f04}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!set\-Accept@{set\-Accept}}
\index{set\-Accept@{set\-Accept}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{set\-Accept}]{\setlength{\rightskip}{0pt plus 5cm}void Packet\-Handler\-::set\-Accept (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{class_vsid_netfilter_1_1_packet_handler_a40ff7c9f8bdbfa5bfe6b1ca94edd2f04}
Wrappers around set verdict. Should only be called from Flow Manager because it checks the config verdict\-After\-Classification 
\begin{DoxyParams}{Parameters}
{\em id} & \\
\hline
\end{DoxyParams}


Implements \hyperlink{class_vsid_common_1_1_packet_verdict_a65a14cfba9da80f91e06feb1e12bde0d}{Vsid\-Common\-::\-Packet\-Verdict}.



Definition at line 418 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
419 \{
420     \textcolor{keywordflow}{if}( \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->verdictAfterClassification() )
421         \hyperlink{class_vsid_netfilter_1_1_packet_handler_abb5ca3f313ceaed495dd06ce56bdf849}{setVerdict}(\textcolor{keywordtype}{id}, NF\_ACCEPT);
422 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_a40ff7c9f8bdbfa5bfe6b1ca94edd2f04_cgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_ad0a799dbbe9a3e6e6310a4d303710aa1}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!set\-Drop@{set\-Drop}}
\index{set\-Drop@{set\-Drop}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{set\-Drop}]{\setlength{\rightskip}{0pt plus 5cm}void Packet\-Handler\-::set\-Drop (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{class_vsid_netfilter_1_1_packet_handler_ad0a799dbbe9a3e6e6310a4d303710aa1}
wrappers around set verdict Should only be called from Flow Manager because it checks the config verdict\-After\-Classification 
\begin{DoxyParams}{Parameters}
{\em id} & \\
\hline
\end{DoxyParams}


Implements \hyperlink{class_vsid_common_1_1_packet_verdict_ad695769962d16d5e76c95f8e569c8b6b}{Vsid\-Common\-::\-Packet\-Verdict}.



Definition at line 424 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
425 \{
426     \textcolor{keywordflow}{if}( \hyperlink{class_vsid_netfilter_1_1_config_abf1d4539011ef83cac0fef2ac864a3a9}{Config::instance}()->verdictAfterClassification() )
427         \hyperlink{class_vsid_netfilter_1_1_packet_handler_abb5ca3f313ceaed495dd06ce56bdf849}{setVerdict}(\textcolor{keywordtype}{id}, NF\_DROP);
428 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_ad0a799dbbe9a3e6e6310a4d303710aa1_cgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_abb5ca3f313ceaed495dd06ce56bdf849}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!set\-Verdict@{set\-Verdict}}
\index{set\-Verdict@{set\-Verdict}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{set\-Verdict}]{\setlength{\rightskip}{0pt plus 5cm}int Packet\-Handler\-::set\-Verdict (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{id, }
\item[{uint32\-\_\-t}]{verdict}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_abb5ca3f313ceaed495dd06ce56bdf849}


Definition at line 237 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
238 \{
239     \textcolor{keywordflow}{if}(verdict > NF\_MAX\_VERDICT || verdict < NF\_DROP)
240     \{
241         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Invalid verdict ["} << verdict << \textcolor{stringliteral}{"]"});
242         \textcolor{keywordflow}{return} -1;
243     \}
244 
245     
246     \textcolor{comment}{// increase stats}
247     std::unique\_lock<std::mutex> statsGuard(\_statsMutex);
248     \_verdictStats[verdict]++;
249     statsGuard.unlock();
250 
251     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Set Verdict pktid=["} << \textcolor{keywordtype}{id} << \textcolor{stringliteral}{"] : "} << verdict)
252     std::lock\_guard<std::mutex> verdictGuard(\_verdictMutex);
253     return nfq\_set\_verdict(\_nfQueue, \textcolor{keywordtype}{id}, verdict, 0, NULL);
254 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_abb5ca3f313ceaed495dd06ce56bdf849_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_afc60de8576a1b1543b8e6b6f9fcca801}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!set\-Verdict@{set\-Verdict}}
\index{set\-Verdict@{set\-Verdict}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{set\-Verdict}]{\setlength{\rightskip}{0pt plus 5cm}int Vsid\-Netfilter\-::\-Packet\-Handler\-::set\-Verdict (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{id, }
\item[{uint32\-\_\-t}]{verdict}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_afc60de8576a1b1543b8e6b6f9fcca801}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a7e8b3ee2c5447a74b41d8fe190c162d0}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!set\-Verdict\-Local@{set\-Verdict\-Local}}
\index{set\-Verdict\-Local@{set\-Verdict\-Local}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{set\-Verdict\-Local}]{\setlength{\rightskip}{0pt plus 5cm}int Vsid\-Netfilter\-::\-Packet\-Handler\-::set\-Verdict\-Local (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{id, }
\item[{uint32\-\_\-t}]{verdict}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a7e8b3ee2c5447a74b41d8fe190c162d0}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!set\-Verdict\-Local@{set\-Verdict\-Local}}
\index{set\-Verdict\-Local@{set\-Verdict\-Local}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{set\-Verdict\-Local}]{\setlength{\rightskip}{0pt plus 5cm}int Packet\-Handler\-::set\-Verdict\-Local (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{id, }
\item[{uint32\-\_\-t}]{verdict}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4}


Definition at line 214 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
215 \{
216     \textcolor{keywordflow}{if}(verdict > NF\_MAX\_VERDICT || verdict < NF\_DROP)
217     \{
218         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}( << \textcolor{stringliteral}{"Invalid verdict ["} << verdict << \textcolor{stringliteral}{"]"});
219         \textcolor{keywordflow}{return} -1;
220     \}
221 
222     \textcolor{comment}{// increase stats}
223     std::unique\_lock<std::mutex> statsGuard(\_statsMutex);
224     \_verdictStats[verdict]++;
225     statsGuard.unlock();
226 
227     std::lock\_guard<std::mutex> verdictGuard(\_verdictMutex);
228     \textcolor{keywordtype}{int} ret = nfq\_set\_verdict(\_nfQueue, \textcolor{keywordtype}{id}, verdict, 0, NULL);
229     \textcolor{keywordflow}{if}(\_buffer)
230     \{
231         \textcolor{keyword}{delete} \_buffer;
232         \_buffer = NULL;
233     \}
234     \textcolor{keywordflow}{return} ret;
235 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_a579cb580e2801acc62e56336b59242c4_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_acba4a3d934d515a3a867c008b3c909a7}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!shutdown@{shutdown}}
\index{shutdown@{shutdown}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{shutdown}]{\setlength{\rightskip}{0pt plus 5cm}void Packet\-Handler\-::shutdown (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_acba4a3d934d515a3a867c008b3c909a7}


Definition at line 410 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
411 \{
412     \_shutdown = \textcolor{keyword}{true};
413     \_flowManager.\hyperlink{class_vsid_common_1_1_flow_manager_a631e775596b97c611f2fb3ee7e207295}{shutdown}();
414     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"Shutdown called for queue ["} << \_queueNumber << \textcolor{stringliteral}{"]"});
415 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_vsid_netfilter_1_1_packet_handler_acba4a3d934d515a3a867c008b3c909a7_cgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_netfilter_1_1_packet_handler_a2296b558ff874f5ddc27e9deecc7bd85}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!shutdown@{shutdown}}
\index{shutdown@{shutdown}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{shutdown}]{\setlength{\rightskip}{0pt plus 5cm}void Vsid\-Netfilter\-::\-Packet\-Handler\-::shutdown (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a2296b558ff874f5ddc27e9deecc7bd85}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_a7a9ae496da5a2eabeeeb2341eb107590}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!verdict\-Stats@{verdict\-Stats}}
\index{verdict\-Stats@{verdict\-Stats}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{verdict\-Stats}]{\setlength{\rightskip}{0pt plus 5cm}std\-::vector$<$uint64\-\_\-t$>$ Vsid\-Netfilter\-::\-Packet\-Handler\-::verdict\-Stats (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_a7a9ae496da5a2eabeeeb2341eb107590}
\hypertarget{class_vsid_netfilter_1_1_packet_handler_aa73cd1027b67da5a9b4526a08065decf}{\index{Vsid\-Netfilter\-::\-Packet\-Handler@{Vsid\-Netfilter\-::\-Packet\-Handler}!verdict\-Stats@{verdict\-Stats}}
\index{verdict\-Stats@{verdict\-Stats}!VsidNetfilter::PacketHandler@{Vsid\-Netfilter\-::\-Packet\-Handler}}
\subsubsection[{verdict\-Stats}]{\setlength{\rightskip}{0pt plus 5cm}std\-::vector$<$ uint64\-\_\-t $>$ Packet\-Handler\-::verdict\-Stats (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_vsid_netfilter_1_1_packet_handler_aa73cd1027b67da5a9b4526a08065decf}


Definition at line 256 of file Packet\-Handler.\-cpp.


\begin{DoxyCode}
257 \{
258     std::lock\_guard<std::mutex> guard(\_statsMutex);
259     \textcolor{keywordflow}{return} \_verdictStats;
260 \}
\end{DoxyCode}


The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
src/netfilter/inc/\hyperlink{netfilter_2inc_2_packet_handler_8h}{Packet\-Handler.\-h}\item 
src/netfilter/src/\hyperlink{netfilter_2src_2_packet_handler_8cpp}{Packet\-Handler.\-cpp}\end{DoxyCompactItemize}
