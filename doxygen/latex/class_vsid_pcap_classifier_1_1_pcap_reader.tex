\hypertarget{class_vsid_pcap_classifier_1_1_pcap_reader}{\section{Vsid\-Pcap\-Classifier\-:\-:Pcap\-Reader Class Reference}
\label{class_vsid_pcap_classifier_1_1_pcap_reader}\index{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}}
}


{\ttfamily \#include $<$Pcap\-Reader.\-h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_vsid_pcap_classifier_1_1_pcap_reader_ad30ce38bfe5ec766670158205a5d2a2f}{Pcap\-Reader} (\hyperlink{class_vsid_common_1_1_flow_manager}{Vsid\-Common\-::\-Flow\-Manager} $\ast$flow\-Manager)
\item 
\hyperlink{class_vsid_pcap_classifier_1_1_pcap_reader_ab352e31cf9a3320ad390d5101d022e5b}{$\sim$\-Pcap\-Reader} ()
\item 
bool \hyperlink{class_vsid_pcap_classifier_1_1_pcap_reader_a8d73bbb229734e2bacce29f212ca2f6d}{read} (const std\-::string \&file\-Name)
\item 
void \hyperlink{class_vsid_pcap_classifier_1_1_pcap_reader_a1e206d73c80ef174903861f22a2e6336}{handle\-Packet} (pcap\-\_\-t $\ast$pcap, const pcap\-\_\-pkthdr $\ast$header, const u\-\_\-char $\ast$packet)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 21 of file Pcap\-Reader.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{class_vsid_pcap_classifier_1_1_pcap_reader_ad30ce38bfe5ec766670158205a5d2a2f}{\index{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}!Pcap\-Reader@{Pcap\-Reader}}
\index{Pcap\-Reader@{Pcap\-Reader}!VsidPcapClassifier::PcapReader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}}
\subsubsection[{Pcap\-Reader}]{\setlength{\rightskip}{0pt plus 5cm}Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader\-::\-Pcap\-Reader (
\begin{DoxyParamCaption}
\item[{{\bf Vsid\-Common\-::\-Flow\-Manager} $\ast$}]{flow\-Manager}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_pcap_classifier_1_1_pcap_reader_ad30ce38bfe5ec766670158205a5d2a2f}


Definition at line 24 of file Pcap\-Reader.\-h.


\begin{DoxyCode}
24                                                    :
25         \_flowManager(flowManager),
26         \_numPackets(0)
27     \{\};
\end{DoxyCode}
\hypertarget{class_vsid_pcap_classifier_1_1_pcap_reader_ab352e31cf9a3320ad390d5101d022e5b}{\index{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}!$\sim$\-Pcap\-Reader@{$\sim$\-Pcap\-Reader}}
\index{$\sim$\-Pcap\-Reader@{$\sim$\-Pcap\-Reader}!VsidPcapClassifier::PcapReader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}}
\subsubsection[{$\sim$\-Pcap\-Reader}]{\setlength{\rightskip}{0pt plus 5cm}Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader\-::$\sim$\-Pcap\-Reader (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{class_vsid_pcap_classifier_1_1_pcap_reader_ab352e31cf9a3320ad390d5101d022e5b}


Definition at line 28 of file Pcap\-Reader.\-h.


\begin{DoxyCode}
28 \{\};
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{class_vsid_pcap_classifier_1_1_pcap_reader_a1e206d73c80ef174903861f22a2e6336}{\index{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}!handle\-Packet@{handle\-Packet}}
\index{handle\-Packet@{handle\-Packet}!VsidPcapClassifier::PcapReader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}}
\subsubsection[{handle\-Packet}]{\setlength{\rightskip}{0pt plus 5cm}void Pcap\-Reader\-::handle\-Packet (
\begin{DoxyParamCaption}
\item[{pcap\-\_\-t $\ast$}]{pcap, }
\item[{const pcap\-\_\-pkthdr $\ast$}]{header, }
\item[{const u\-\_\-char $\ast$}]{packet}
\end{DoxyParamCaption}
)}}\label{class_vsid_pcap_classifier_1_1_pcap_reader_a1e206d73c80ef174903861f22a2e6336}
Handle a packet


\begin{DoxyParams}{Parameters}
{\em pcap} & \\
\hline
{\em header} & \\
\hline
{\em packet} & \\
\hline
\end{DoxyParams}


Definition at line 40 of file Pcap\-Reader.\-cpp.


\begin{DoxyCode}
43 \{
44     \_numPackets++;
45     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"Packet count : "} << \_numPackets);
46     \textcolor{comment}{//LOG\_HEXDUMP("Packet :", packet, pkthdr->len)}
47     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"ts.sec : "} << pkthdr->ts.tv\_sec << \textcolor{stringliteral}{" ts.usec : "} << pkthdr->ts.tv\_usec);
48     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"caplen : "} << pkthdr->caplen);
49     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"len : "} << pkthdr->len);
50 
51     \textcolor{keywordtype}{int} linktype;
52 
53     uint32\_t linkhdrlen = 14;
54  
55     \textcolor{comment}{// Determine the datalink layer type.}
56     \textcolor{keywordflow}{if} ((linktype = pcap\_datalink(pcap)) < 0)
57     \{
58         \hyperlink{_logger_8h_aa2ffef3c03ca18789b5d04ac9b260128}{LOG\_ERROR}((\textcolor{stringliteral}{"pcap\_datalink(): %v\(\backslash\)n"}, pcap\_geterr(pcap)));
59         \textcolor{keywordflow}{return};
60     \}
61  
62     \textcolor{comment}{// Set the datalink layer header size.}
63     \textcolor{keywordflow}{switch} (linktype)
64     \{
65     \textcolor{keywordflow}{case} DLT\_NULL:
66         linkhdrlen = 4;
67         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"DLT\_NULL"});
68         \textcolor{keywordflow}{break};
69  
70     \textcolor{keywordflow}{case} DLT\_EN10MB:
71         linkhdrlen = LL\_ETH\_HDR\_LEN;
72         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"DLT\_EN10MB"});
73         \textcolor{keywordflow}{break};
74  
75     \textcolor{keywordflow}{case} DLT\_SLIP:
76     \textcolor{keywordflow}{case} DLT\_PPP:
77         linkhdrlen = 24;
78         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"DLT\_PPP"});
79         \textcolor{keywordflow}{break};
80  
81     \textcolor{keywordflow}{case} DLT\_LINUX\_SLL:
82         linkhdrlen = LL\_SLL\_HDR\_LEN;
83         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"LL\_SLL\_HDR\_LEN"});
84         \textcolor{keywordflow}{break};
85     \textcolor{keywordflow}{default}:
86         \hyperlink{_logger_8h_aa2ffef3c03ca18789b5d04ac9b260128}{LOG\_ERROR}((\textcolor{stringliteral}{"Unsupported datalink (%v)\(\backslash\)n"}, linktype));
87         \textcolor{keywordflow}{return};
88     \}
89 
90     u\_char* myPacketCpy = \textcolor{keyword}{new} u\_char[pkthdr->len];
91     memcpy(myPacketCpy, packet, pkthdr->len);
92 
93 
94     \textcolor{keyword}{struct }ip\_vhl \{
95         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ip\_hl:4; \textcolor{comment}{// only in IPv4}
96         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ip\_v:4;
97     \};  
98 
99     \textcolor{comment}{// IP Header}
100     \textcolor{keyword}{const} u\_char* ip\_hdr\_start = myPacketCpy + linkhdrlen;
101 
102     ip\_vhl* vhl = (\textcolor{keyword}{struct }ip\_vhl*)(ip\_hdr\_start);
103     \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"IP - HLen : "} << vhl->ip\_hl * 4 << \textcolor{stringliteral}{" - Ver : "} << vhl->ip\_v);
104 
105     \textcolor{keywordflow}{if}(vhl->ip\_v == IPv4)
106     \{
107         \textcolor{keyword}{struct }iphdr* ip\_hdr = (\textcolor{keyword}{struct }iphdr*)(ip\_hdr\_start);
108         \textcolor{keyword}{const} u\_char* transport\_hdr\_start = ip\_hdr\_start + (vhl->ip\_hl * 4);
109 
110         \textcolor{comment}{// extract the source and the destination ip-adrress}
111         in\_addr* srcIp = (in\_addr*) &ip\_hdr->saddr;
112         in\_addr* dstIp = (in\_addr*) &ip\_hdr->daddr;
113 
114         \textcolor{comment}{// convert datagram network byte order to host byte order and calculate}
115         \textcolor{comment}{// the header size}
116         \textcolor{comment}{//uint16\_t ipDatagramSize = ntohs(ip\_hdr->ip\_len);}
117         \textcolor{comment}{//uint16\_t headerSize     = IP\_HL(ip\_hdr) << 2;}
118 
119         \textcolor{keywordtype}{char} src[INET6\_ADDRSTRLEN];
120         inet\_ntop(AF\_INET, srcIp, src, INET6\_ADDRSTRLEN);
121 
122         \textcolor{keywordtype}{char} dst[INET6\_ADDRSTRLEN];
123         inet\_ntop(AF\_INET, dstIp, dst, INET6\_ADDRSTRLEN);
124 
125         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"src ip : "} << src );
126         \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"dst ip : "} << dst );
127 
128         \textcolor{comment}{// Transport Layer Header}
129         \textcolor{keywordflow}{switch}(ip\_hdr->protocol)
130         \{
131             \textcolor{keywordflow}{case} IPPROTO\_ICMP:
132             \{
133                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"IPPROTO\_ICMP"});
134                 \textcolor{keywordflow}{break};
135             \}
136             \textcolor{keywordflow}{case} IPPROTO\_TCP:
137             \{
138                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"IPPROTO\_TCP"});
139 
140                 \textcolor{keyword}{struct }tcphdr* tcph = (\textcolor{keyword}{struct }tcphdr*)(transport\_hdr\_start);
141 
142                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}(<< \textcolor{stringliteral}{"tcph->doff : "} << tcph->doff);
143                 \textcolor{keyword}{const} u\_char* data\_start = transport\_hdr\_start  + tcph->doff * 4;
144                 
145                 \hyperlink{class_vsid_common_1_1_tcp_i_pv4}{TcpIPv4}* tcp = \textcolor{keyword}{new} \hyperlink{class_vsid_common_1_1_tcp_i_pv4}{TcpIPv4}(myPacketCpy, pkthdr->len, ip\_hdr\_start, 
146                                             transport\_hdr\_start, data\_start, 
147                                             pkthdr->ts,
148                                             myPacketCpy);
149 
150                 \_flowManager->\hyperlink{class_vsid_common_1_1_flow_manager_a9c840fe2a6650079a3b90ba2d65f1e7e}{addPacket}(tcp);
151 
152                 \textcolor{keywordflow}{break};
153             \}
154             \textcolor{keywordflow}{case} IPPROTO\_UDP:
155             \{
156                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"IPPROTO\_UDP"});
157 
158                 \textcolor{keyword}{const} u\_char* data\_start = transport\_hdr\_start + \textcolor{keyword}{sizeof}(udphdr);
159 
160                 \hyperlink{class_vsid_common_1_1_udp_i_pv4}{UdpIPv4}* udp = \textcolor{keyword}{new} \hyperlink{class_vsid_common_1_1_udp_i_pv4}{UdpIPv4}(myPacketCpy, pkthdr->len, ip\_hdr\_start, 
161                                         transport\_hdr\_start, data\_start, 
162                                         pkthdr->ts,
163                                         myPacketCpy);
164 
165                 \_flowManager->\hyperlink{class_vsid_common_1_1_flow_manager_a9c840fe2a6650079a3b90ba2d65f1e7e}{addPacket}(udp);
166 
167                 \textcolor{keywordflow}{break};
168             \}
169             \textcolor{keywordflow}{case} IPPROTO\_SCTP:
170             \{
171                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"IPPROTO\_SCTP"});
172                 \textcolor{keywordflow}{break};
173             \}
174             \textcolor{keywordflow}{default}:
175             \{
176                 \hyperlink{_logger_8h_a119c1c29ba35a8db38e2358e41167282}{SLOG\_INFO}( << \textcolor{stringliteral}{"UNKNOWN IPPROTO : "} << ip\_hdr->protocol);
177             \}
178 
179         \}
180     \}
181     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(vhl->ip\_v == IPv6)
182     \{
183         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"IP Version 6 not supported yet"})
184         return;
185     \}
186     else
187     \{
188         \hyperlink{_logger_8h_a2a8694cd392d18f4db6b9cc9f15bafe3}{SLOG\_ERROR}(<< \textcolor{stringliteral}{"Invalid IP Version : "} << vhl->ip\_v)
189         return;
190     \}
191 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=324pt]{class_vsid_pcap_classifier_1_1_pcap_reader_a1e206d73c80ef174903861f22a2e6336_icgraph}
\end{center}
\end{figure}


\hypertarget{class_vsid_pcap_classifier_1_1_pcap_reader_a8d73bbb229734e2bacce29f212ca2f6d}{\index{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}!read@{read}}
\index{read@{read}!VsidPcapClassifier::PcapReader@{Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}bool Vsid\-Pcap\-Classifier\-::\-Pcap\-Reader\-::read (
\begin{DoxyParamCaption}
\item[{const std\-::string \&}]{file\-Name}
\end{DoxyParamCaption}
)}}\label{class_vsid_pcap_classifier_1_1_pcap_reader_a8d73bbb229734e2bacce29f212ca2f6d}
read a pcap file 
\begin{DoxyParams}{Parameters}
{\em file\-Name} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=256pt]{class_vsid_pcap_classifier_1_1_pcap_reader_a8d73bbb229734e2bacce29f212ca2f6d_icgraph}
\end{center}
\end{figure}




The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
src/pcap\-\_\-classifier/inc/\hyperlink{pcap__classifier_2inc_2_pcap_reader_8h}{Pcap\-Reader.\-h}\item 
src/pcap\-\_\-classifier/src/\hyperlink{pcap__classifier_2src_2_pcap_reader_8cpp}{Pcap\-Reader.\-cpp}\end{DoxyCompactItemize}
